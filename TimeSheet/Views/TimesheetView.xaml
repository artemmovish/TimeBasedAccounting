<UserControl x:Class="TimeSheet.Views.TimesheetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <TextBlock Grid.Row="0" Text="Табель учета рабочего времени" 
                   FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- Фильтры -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Сотрудник -->
            <StackPanel Grid.Column="0" Margin="0,0,15,0">
                <TextBlock Text="Сотрудник" Margin="0,0,0,5"/>
                <ComboBox ItemsSource="{Binding Employees}" 
                          DisplayMemberPath="FullName"
                          SelectedItem="{Binding SelectedEmployee}"
                          Height="25"/>
            </StackPanel>

            <!-- Месяц -->
            <StackPanel Grid.Column="1" Margin="0,0,15,0">
                <TextBlock Text="Месяц" Margin="0,0,0,5"/>
                <ComboBox x:Name="MonthComboBox" 
                          SelectedValue="{Binding SelectedMonth}" 
                          SelectedValuePath="Tag"
                          Width="120" Height="25">
                    <ComboBoxItem Content="Январь" Tag="1"/>
                    <ComboBoxItem Content="Февраль" Tag="2"/>
                    <ComboBoxItem Content="Март" Tag="3"/>
                    <ComboBoxItem Content="Апрель" Tag="4"/>
                    <ComboBoxItem Content="Май" Tag="5"/>
                    <ComboBoxItem Content="Июнь" Tag="6"/>
                    <ComboBoxItem Content="Июль" Tag="7"/>
                    <ComboBoxItem Content="Август" Tag="8"/>
                    <ComboBoxItem Content="Сентябрь" Tag="9"/>
                    <ComboBoxItem Content="Октябрь" Tag="10"/>
                    <ComboBoxItem Content="Ноябрь" Tag="11"/>
                    <ComboBoxItem Content="Декабрь" Tag="12"/>
                </ComboBox>
            </StackPanel>

            <!-- Год -->
            <StackPanel Grid.Column="2" Margin="0,0,15,0">
                <TextBlock Text="Год" Margin="0,0,0,5"/>
                <ComboBox SelectedValue="{Binding SelectedYear}" 
                          SelectedValuePath="Content"
                          Width="80" Height="25">
                    <ComboBoxItem Content="2023"/>
                    <ComboBoxItem Content="2024"/>
                    <ComboBoxItem Content="2025"/>
                </ComboBox>
            </StackPanel>

            <Button Grid.Column="3" Content="Обновить" 
                    Command="{Binding LoadTimesheetsCommand}"
                    VerticalAlignment="Bottom" Padding="15,7" 
                    Background="#3498DB" Foreground="White" Height="30"/>
        </Grid>

        <!-- Таблица табелей -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Timesheets}" SelectedItem="{Binding SelectedTimesheet}"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  Background="White">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM.yyyy}" Width="100"/>
                <DataGridTextColumn Header="Отработано часов" Binding="{Binding HoursWorked}" Width="120"/>
                <DataGridTextColumn Header="Маркер" Binding="{Binding AttendanceMarker.Code}" Width="80"/>
                <DataGridTextColumn Header="Описание" Binding="{Binding AttendanceMarker.Description}" Width="150"/>
                <DataGridTextColumn Header="Записано" Binding="{Binding RecordedAt, StringFormat=dd.MM.yyyy HH:mm}" Width="120"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Кнопки операций -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Left" Visibility="{Binding IsAdmin, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Button Content="Добавить запись" 
                        Command="{Binding CreateTimesheetCommand}"
                        Padding="15,8" Background="#27AE60" Foreground="White" Margin="0,0,10,0"/>
            <Button Content="Редактировать запись" 
                        Command="{Binding EditTimesheetCommand}"
                        Padding="15,8" Background="#3498DB" Foreground="White" Margin="0,0,10,0"/>
            <Button Content="Добавить опоздание" 
                        Command="{Binding AddLatenessCommand}"
                        Padding="15,8" Background="#E67E22" Foreground="White"/>
        </StackPanel>
        
        <!-- Режим операции -->
        <ContentControl Grid.Row="0" Grid.RowSpan="4"
                       Content="{Binding CurrentOperationView}"
                       Visibility="{Binding IsOperationMode, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    </Grid>
</UserControl>