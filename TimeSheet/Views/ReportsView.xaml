<UserControl x:Class="TimeSheet.Views.ReportsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <TextBlock Grid.Row="0" Text="Отчеты" FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- Параметры отчета -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <TextBlock Text="Тип отчета" Margin="0,0,0,5"/>
                <ComboBox SelectedValue="{Binding SelectedReportType}" 
                          SelectedValuePath="Tag">
                    <ComboBoxItem Content="Посещаемость" Tag="attendance"/>
                    <ComboBoxItem Content="Опоздания" Tag="lateness"/>
                </ComboBox>
            </StackPanel>

            <StackPanel Grid.Column="1" Margin="0,0,10,0">
                <TextBlock Text="Отдел" Margin="0,0,0,5"/>
                <ComboBox ItemsSource="{Binding Departments}" 
                          DisplayMemberPath="Name"
                          SelectedItem="{Binding SelectedDepartment}">
                </ComboBox>
            </StackPanel>

            <StackPanel Grid.Column="2" Margin="0,0,10,0">
                <TextBlock Text="Сотрудник" Margin="0,0,0,5"/>
                <ComboBox ItemsSource="{Binding Employees}" 
                          DisplayMemberPath="FullName"
                          SelectedItem="{Binding SelectedEmployee}">
                </ComboBox>
            </StackPanel>

            <StackPanel Grid.Column="3" VerticalAlignment="Bottom">
                <TextBlock Text="Период" Margin="0,0,0,5"/>
                <DatePicker SelectedDate="{Binding SelectedPeriod}" Width="120"/>
            </StackPanel>
        </Grid>

        <!-- Кнопка генерации -->
        <Button Grid.Row="2" Content="Сгенерировать отчет" 
                Command="{Binding GenerateReportCommand}"
                IsEnabled="{Binding IsGeneratingReport, Converter={StaticResource InverseBooleanConverter}}"
                HorizontalAlignment="Left" Padding="20,10" Background="#1ABC9C" 
                Foreground="White" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- Результаты отчета -->
        <Border Grid.Row="3" BorderBrush="#BDC3C7" BorderThickness="1" 
                Background="#FAFAFA" Padding="15">
            <ScrollViewer>
                <TextBlock Text="{Binding ReportData, Converter={StaticResource JsonToFormattedTextConverter}}" 
                   TextWrapping="Wrap" FontFamily="Consolas, Courier New"/>
            </ScrollViewer>
        </Border>

        <!-- Индикатор загрузки -->
        <Grid Grid.Row="3" Background="#CCFFFFFF" 
              Visibility="{Binding IsGeneratingReport, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="10" Margin="0,0,0,10"/>
                <TextBlock Text="Генерация отчета..." HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>